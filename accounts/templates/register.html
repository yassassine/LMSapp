{% extends "base.html" %}
{% load static %}

{% block title %}Création de compte - Garderie Scolaire{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Créer un compte</title>
</head>
<body>
    <h1>Page d'inscription</h1>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">S'inscrire</button>
    </form>
    <p>Déjà inscrit ? <a href="{% url 'login' %}">Se connecter</a></p>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-header bg-success text-white text-center">
                    <h2><i class="fas fa-user-plus me-2"></i>Création de compte</h2>
                    <p class="mb-0">Rejoignez notre communauté éducative</p>
                </div>
                
                <div class="card-body">
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-id-card me-2"></i>Informations personnelles
                                </h4>
                                
                                <div class="mb-3">
                                    <label for="id_first_name" class="form-label">
                                        <i class="fas fa-signature me-1"></i>Prénom
                                    </label>
                                    <input 
                                        type="text" 
                                        name="first_name" 
                                        id="id_first_name" 
                                        class="form-control"
                                        placeholder="Votre prénom"
                                        value="{{ form.first_name.value|default:'' }}"
                                        required
                                    >
                                    <div class="invalid-feedback">
                                        Veuillez saisir votre prénom.
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="id_last_name" class="form-label">
                                        <i class="fas fa-signature me-1"></i>Nom
                                    </label>
                                    <input 
                                        type="text" 
                                        name="last_name" 
                                        id="id_last_name" 
                                        class="form-control"
                                        placeholder="Votre nom"
                                        value="{{ form.last_name.value|default:'' }}"
                                        required
                                    >
                                    <div class="invalid-feedback">
                                        Veuillez saisir votre nom.
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="id_email" class="form-label">
                                        <i class="fas fa-envelope me-1"></i>Email
                                    </label>
                                    <input 
                                        type="email" 
                                        name="email" 
                                        id="id_email" 
                                        class="form-control"
                                        placeholder="exemple@domaine.com"
                                        value="{{ form.email.value|default:'' }}"
                                        required
                                    >
                                    <div class="invalid-feedback">
                                        Veuillez saisir une adresse email valide.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h4 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-user-shield me-2"></i>Identifiants
                                </h4>
                                
                                <div class="mb-3">
                                    <label for="id_username" class="form-label">
                                        <i class="fas fa-user me-1"></i>Nom d'utilisateur
                                    </label>
                                    <input 
                                        type="text" 
                                        name="username" 
                                        id="id_username" 
                                        class="form-control"
                                        placeholder="Choisissez un nom d'utilisateur"
                                        value="{{ form.username.value|default:'' }}"
                                        required
                                    >
                                    <div class="invalid-feedback">
                                        Veuillez choisir un nom d'utilisateur.
                                    </div>
                                    <small class="form-text text-muted">
                                        150 caractères maximum. Lettres, chiffres et @/./+/-/_ seulement.
                                    </small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="id_password1" class="form-label">
                                        <i class="fas fa-lock me-1"></i>Mot de passe
                                    </label>
                                    <input 
                                        type="password" 
                                        name="password1" 
                                        id="id_password1" 
                                        class="form-control"
                                        placeholder="Créez un mot de passe sécurisé"
                                        required
                                    >
                                    <div class="invalid-feedback">
                                        Veuillez saisir un mot de passe.
                                    </div>
                                    <small class="form-text text-muted">
                                        • 8 caractères minimum<br>
                                        • Pas uniquement numérique<br>
                                        • Difficile à deviner
                                    </small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="id_password2" class="form-label">
                                        <i class="fas fa-check-circle me-1"></i>Confirmation
                                    </label>
                                    <input 
                                        type="password" 
                                        name="password2" 
                                        id="id_password2" 
                                        class="form-control"
                                        placeholder="Retapez votre mot de passe"
                                        required
                                    >
                                    <div class="invalid-feedback">
                                        Les mots de passe doivent correspondre.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <h4 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-users me-2"></i>Profil
                                </h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">
                                        <i class="fas fa-user-tag me-1"></i>Je suis :
                                    </label>
                                    <div class="d-flex justify-content-around mt-3">
                                        <div class="form-check form-check-inline">
                                            <input 
                                                class="form-check-input" 
                                                type="radio" 
                                                name="role" 
                                                id="role_parent" 
                                                value="parent"
                                                {% if form.role.value == 'parent' %}checked{% endif %}
                                                required
                                            >
                                            <label class="form-check-label" for="role_parent">
                                                <i class="fas fa-user-friends me-1"></i>Parent
                                            </label>
                                        </div>
                                        
                                        <div class="form-check form-check-inline">
                                            <input 
                                                class="form-check-input" 
                                                type="radio" 
                                                name="role" 
                                                id="role_teacher" 
                                                value="teacher"
                                                {% if form.role.value == 'teacher' %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="role_teacher">
                                                <i class="fas fa-chalkboard-teacher me-1"></i>Enseignant
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input 
                                            class="form-check-input" 
                                            type="checkbox" 
                                            id="terms" 
                                            required
                                        >
                                        <label class="form-check-label" for="terms">
                                            J'accepte les <a href="#" class="text-decoration-none">conditions d'utilisation</a> 
                                            et la <a href="#" class="text-decoration-none">politique de confidentialité</a>
                                        </label>
                                        <div class="invalid-feedback">
                                            Vous devez accepter les conditions.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Affichage des erreurs globales -->
                        {% if form.errors %}
                        <div class="alert alert-danger">
                            <strong>Erreurs :</strong>
                            <ul class="mb-0">
                                {% for field, errors in form.errors.items %}
                                    {% for error in errors %}
                                        <li>{{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-user-check me-2"></i>Créer mon compte
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="card-footer text-center">
                    <p class="mb-0">
                        Vous avez déjà un compte ? 
                        <a href="{% url 'login' %}" class="text-decoration-none">
                            Connectez-vous ici
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
{% endblock %}

{% block extra_js %}
<script>
// Validation Bootstrap
(() => {
  'use strict'
  const forms = document.querySelectorAll('.needs-validation')
  
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }
      
      // Vérification de la correspondance des mots de passe
      const password1 = document.getElementById('id_password1')
      const password2 = document.getElementById('id_password2')
      
      if (password1.value !== password2.value) {
        password2.setCustomValidity("Les mots de passe ne correspondent pas")
        password2.classList.add('is-invalid')
      } else {
        password2.setCustomValidity("")
        password2.classList.remove('is-invalid')
      }
      
      form.classList.add('was-validated')
    }, false)
  })
})()
</script>
{% endblock %}